<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mensajería | Liderman</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
      background: #0a0f1e;
      color: #fff;
      overflow-x: hidden;
    }

    /* Gradiente animado de fondo */
    .hero-gradient {
      background: linear-gradient(135deg, 
        #0a0f1e 0%, 
        #111827 25%,
        #1e293b 50%,
        #0f172a 75%,
        #0a0f1e 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      min-height: 100vh;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    /* Glass card minimalista */
    .glass-card {
      background: rgba(255, 255, 255, 0.02);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .gradient-text {
      background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 50%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Navbar */
    .navbar {
      background: rgba(10, 15, 30, 0.8);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }

    /* Lista de conversaciones */
    .conversacion-item {
      padding: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: all 0.2s;
    }

    .conversacion-item:hover {
      background: rgba(59, 130, 246, 0.05);
      border-left: 3px solid #3b82f6;
    }

    .conversacion-item.active {
      background: rgba(59, 130, 246, 0.1);
      border-left: 3px solid #3b82f6;
    }

    .conversacion-item.no-leido {
      background: rgba(59, 130, 246, 0.03);
    }

    /* Avatar */
    .avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3b82f6, #ec4899);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
    }

    .avatar-small {
      width: 32px;
      height: 32px;
      font-size: 0.75rem;
    }

    /* Badge */
    .badge-count {
      min-width: 20px;
      height: 20px;
      padding: 0 6px;
      background: #ef4444;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
    }

    /* Chat area */
    .chat-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 64px);
    }

    .chat-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.02);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
      scroll-behavior: smooth;
    }

    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.02);
      border-radius: 3px;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: rgba(59, 130, 246, 0.3);
      border-radius: 3px;
    }

    .chat-messages::-webkit-scrollbar-thumb:hover {
      background: rgba(59, 130, 246, 0.5);
    }

    .chat-bubble {
      max-width: 70%;
      padding: 0.875rem 1.125rem;
      border-radius: 1.25rem;
      margin-bottom: 0.75rem;
      word-wrap: break-word;
      animation: fadeInUp 0.3s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .chat-bubble.postulante {
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.3);
      margin-right: auto;
      border-bottom-left-radius: 0.25rem;
    }

    .chat-bubble.reclutador {
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid rgba(16, 185, 129, 0.3);
      margin-left: auto;
      border-bottom-right-radius: 0.25rem;
    }

    .chat-input-area {
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding: 1.5rem;
      background: rgba(15, 23, 42, 0.6);
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 0.75rem 1rem;
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 1rem;
      border-bottom-left-radius: 0.25rem;
      width: fit-content;
      margin-bottom: 0.5rem;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(59, 130, 246, 0.6);
      animation: typingBounce 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typingBounce {
      0%, 60%, 100% {
        transform: translateY(0);
      }
      30% {
        transform: translateY(-8px);
      }
    }

    /* Lista de conversaciones scroll */
    .conversaciones-lista {
      height: calc(100vh - 220px);
      overflow-y: auto;
    }

    .conversaciones-lista::-webkit-scrollbar {
      width: 6px;
    }

    .conversaciones-lista::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.02);
    }

    .conversaciones-lista::-webkit-scrollbar-thumb {
      background: rgba(59, 130, 246, 0.3);
      border-radius: 3px;
    }

    /* Estado de conexión */
    .estado-online {
      width: 10px;
      height: 10px;
      background: #10b981;
      border-radius: 50%;
      border: 2px solid rgba(10, 15, 30, 0.8);
      position: absolute;
      bottom: 2px;
      right: 2px;
    }

    .estado-offline {
      background: #6b7280;
    }

    /* Empty state */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #6b7280;
    }

    /* Filtro activo */
    .filter-btn.active {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.5);
      color: #60a5fa;
    }
  </style>
</head>
<body class="hero-gradient">

  <!-- Navbar -->
  <nav class="navbar fixed w-full top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center gap-4">
          <a href="dashboard.html" class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-pink-500 flex items-center justify-center font-bold text-white">
              L
            </div>
            <span class="text-xl font-bold gradient-text">Liderman</span>
          </a>
          <span class="text-gray-400 text-sm">/ Mensajería</span>
        </div>
        
        <div class="flex items-center gap-6">
          <span id="userInfo" class="text-sm text-gray-400"></span>
          <button onclick="cerrarSesion()" class="text-sm text-red-400 hover:text-red-300 transition-colors">
            Cerrar Sesión
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Contenido Principal -->
  <div class="pt-24 px-6 pb-6 max-w-[1800px] mx-auto">
    <div class="grid grid-cols-12 gap-6 h-[calc(100vh-120px)]">
      
      <!-- Panel Izquierdo - Lista de Conversaciones -->
      <div class="col-span-12 lg:col-span-4 xl:col-span-3">
        <div class="glass-card rounded-2xl h-full flex flex-col">
          
          <!-- Header con búsqueda -->
          <div class="p-6 border-b border-white/5">
            <h2 class="text-2xl font-bold gradient-text mb-4">Mensajes</h2>
            
            <!-- Búsqueda -->
            <div class="relative mb-4">
              <input 
                type="text" 
                id="searchInput"
                placeholder="Buscar conversación..."
                class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 pl-11 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent text-sm"
                oninput="filtrarConversaciones()"
              />
              <svg class="w-5 h-5 text-gray-400 absolute left-3 top-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </div>

            <!-- Filtros -->
            <div class="flex gap-2">
              <button onclick="cambiarFiltro('todos')" class="filter-btn active flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-xs font-medium transition-all">
                Todos <span id="countTodos" class="ml-1">(8)</span>
              </button>
              <button onclick="cambiarFiltro('no-leidos')" class="filter-btn flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-xs font-medium transition-all">
                No leídos <span id="countNoLeidos" class="ml-1">(7)</span>
              </button>
            </div>
          </div>

          <!-- Lista de conversaciones -->
          <div class="conversaciones-lista" id="conversacionesLista">
            <!-- Se llenará dinámicamente -->
          </div>

        </div>
      </div>

      <!-- Panel Derecho - Chat -->
      <div class="col-span-12 lg:col-span-8 xl:col-span-9">
        <div class="glass-card rounded-2xl h-full">
          
          <!-- Estado vacío -->
          <div id="emptyState" class="empty-state">
            <svg class="w-24 h-24 mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
            <h3 class="text-xl font-semibold mb-2">Selecciona una conversación</h3>
            <p class="text-sm">Elige un mensaje de la izquierda para comenzar a chatear</p>
          </div>

          <!-- Chat activo -->
          <div id="chatActivo" class="chat-container" style="display: none;">
            
            <!-- Header del chat -->
            <div class="chat-header">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="relative">
                    <div id="chatAvatar" class="avatar"></div>
                    <div id="chatEstadoIndicador" class="estado-online"></div>
                  </div>
                  <div>
                    <h3 id="chatNombre" class="text-lg font-bold text-white"></h3>
                    <p id="chatPuesto" class="text-sm text-gray-400"></p>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <button class="p-2 hover:bg-white/5 rounded-lg transition-colors" title="Buscar en conversación">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                  </button>
                  <button class="p-2 hover:bg-white/5 rounded-lg transition-colors" title="Ver perfil">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                  </button>
                  <button onclick="cerrarChatActivo()" class="p-2 hover:bg-white/5 rounded-lg transition-colors lg:hidden" title="Cerrar">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Mensajes -->
            <div id="chatMessages" class="chat-messages">
              <!-- Se llenará dinámicamente -->
            </div>

            <!-- Área de entrada -->
            <div class="chat-input-area">
              <div class="flex gap-3 mb-3">
                <button class="p-2 hover:bg-white/5 rounded-lg transition-colors group" title="Adjuntar archivo">
                  <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                  </svg>
                </button>
                <button class="p-2 hover:bg-white/5 rounded-lg transition-colors group" title="Plantillas rápidas" onclick="mostrarPlantillas()">
                  <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                  </svg>
                </button>
                <button class="p-2 hover:bg-white/5 rounded-lg transition-colors group" title="Emoji">
                  <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </button>
              </div>
              <div class="flex gap-3">
                <input 
                  type="text" 
                  id="chatInput" 
                  placeholder="Escribe un mensaje..."
                  class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent"
                  onkeypress="if(event.key === 'Enter') enviarMensaje()"
                />
                <button 
                  onclick="enviarMensaje()" 
                  class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl transition-all duration-200 hover:scale-105 flex items-center gap-2 font-semibold"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                  </svg>
                  Enviar
                </button>
              </div>
            </div>

          </div>

        </div>
      </div>

    </div>
  </div>

  <script>
    // Verificar autenticación
    function verificarAutenticacion() {
      const sessionData = sessionStorage.getItem('reclutadorSession') || 
                          localStorage.getItem('reclutadorSession');
      
      if (!sessionData) {
        window.location.href = 'login.html';
        return null;
      }
      
      return JSON.parse(sessionData);
    }

    // Cerrar sesión
    function cerrarSesion() {
      if (confirm('¿Estás seguro de cerrar sesión?')) {
        sessionStorage.removeItem('reclutadorSession');
        localStorage.removeItem('reclutadorSession');
        window.location.href = 'login.html';
      }
    }

    // Datos de mensajes y conversaciones
    const mensajes = [
      {
        id: 1,
        nombre: 'Juan Pérez',
        mensaje: '¿Cuándo sería la fecha de inicio?',
        hora: '10:42 AM',
        leido: false,
        avatar: 'JP',
        puesto: 'Supervisor de Seguridad',
        online: true
      },
      {
        id: 2,
        nombre: 'María López',
        mensaje: 'Confirmo mi asistencia para mañana',
        hora: '10:15 AM',
        leido: false,
        avatar: 'ML',
        puesto: 'Guardia de Seguridad',
        online: true
      },
      {
        id: 3,
        nombre: 'Carlos Ruiz',
        mensaje: '¿La capacitación es en el mismo lugar?',
        hora: '9:55 AM',
        leido: false,
        avatar: 'CR',
        puesto: 'Almacenero',
        online: false
      },
      {
        id: 4,
        nombre: 'Ana Torres',
        mensaje: 'Gracias por la información',
        hora: '9:35 AM',
        leido: false,
        avatar: 'AT',
        puesto: 'Operador de Montacargas',
        online: true
      },
      {
        id: 5,
        nombre: 'Luis Mendoza',
        mensaje: '¿Cuándo podría tener una entrevista?',
        hora: '9:27 AM',
        leido: false,
        avatar: 'LM',
        puesto: 'Cajero',
        online: false
      },
      {
        id: 6,
        nombre: 'Patricia Vargas',
        mensaje: '¿El puesto tiene posibilidades de crecimiento?',
        hora: 'Ayer',
        leido: false,
        avatar: 'PV',
        puesto: 'Empaquetador',
        online: false
      },
      {
        id: 7,
        nombre: 'Roberto Sánchez',
        mensaje: 'Perfecto, muchas gracias',
        hora: 'Ayer',
        leido: false,
        avatar: 'RS',
        puesto: 'Reponedor',
        online: true
      },
      {
        id: 8,
        nombre: 'Sofia Ramirez',
        mensaje: '¿Qué software manejan?',
        hora: '2 días',
        leido: true,
        avatar: 'SR',
        puesto: 'Analista de Calidad',
        online: false
      }
    ];

    // Historial de conversaciones
    const conversaciones = {
      1: [
        { tipo: 'postulante', mensaje: '¿Cuándo sería la fecha de inicio para el puesto de Supervisor de Seguridad?', hora: '10:30 AM' },
        { tipo: 'reclutador', mensaje: 'Hola Juan, gracias por tu interés. La fecha de inicio sería el 15 de noviembre. ¿Te parece bien?', hora: '10:35 AM' },
        { tipo: 'postulante', mensaje: 'Perfecto, me viene muy bien. ¿Cuál sería el siguiente paso en el proceso?', hora: '10:37 AM' },
        { tipo: 'reclutador', mensaje: 'El siguiente paso es una entrevista presencial. ¿Tienes disponibilidad esta semana?', hora: '10:40 AM' },
        { tipo: 'postulante', mensaje: 'Sí, tengo disponibilidad toda la semana excepto el miércoles.', hora: '10:42 AM' }
      ],
      2: [
        { tipo: 'postulante', mensaje: 'Buenos días, quisiera saber más detalles sobre el horario de trabajo para Guardia de Seguridad.', hora: '10:05 AM' },
        { tipo: 'reclutador', mensaje: 'Buenos días María, el horario es rotativo: turnos de día (6am-2pm), tarde (2pm-10pm) y noche (10pm-6am).', hora: '10:10 AM' },
        { tipo: 'postulante', mensaje: 'Entiendo. ¿Los turnos rotan semanalmente?', hora: '10:12 AM' },
        { tipo: 'reclutador', mensaje: 'Sí, exactamente. La rotación es semanal para que todos los guardias tengan equidad en los horarios.', hora: '10:13 AM' },
        { tipo: 'postulante', mensaje: 'Confirmo mi asistencia para mañana', hora: '10:15 AM' }
      ],
      3: [
        { tipo: 'postulante', mensaje: 'Hola, me gustaría confirmar si el puesto de Almacenero incluye capacitación inicial.', hora: '9:45 AM' },
        { tipo: 'reclutador', mensaje: 'Sí Carlos, incluye una semana de capacitación remunerada antes de empezar formalmente.', hora: '9:50 AM' },
        { tipo: 'postulante', mensaje: '¡Excelente! ¿La capacitación es en el mismo centro de trabajo?', hora: '9:52 AM' },
        { tipo: 'reclutador', mensaje: 'Así es, será en nuestro centro de San Miguel de lunes a viernes.', hora: '9:55 AM' }
      ],
      4: [
        { tipo: 'postulante', mensaje: 'Buenas tardes, ¿el puesto de Operador de Montacargas requiere certificación previa?', hora: '9:30 AM' },
        { tipo: 'reclutador', mensaje: 'Buenas tardes Ana, sí es necesario contar con certificación vigente de operador de montacargas.', hora: '9:32 AM' },
        { tipo: 'postulante', mensaje: 'Gracias por la información', hora: '9:35 AM' }
      ],
      5: [
        { tipo: 'postulante', mensaje: 'Hola, quería consultar sobre los beneficios que ofrece el puesto de Cajero.', hora: '9:20 AM' },
        { tipo: 'reclutador', mensaje: 'Hola Luis, los beneficios incluyen: seguro de salud, bonos por desempeño y descuentos en tiendas del grupo.', hora: '9:25 AM' },
        { tipo: 'postulante', mensaje: 'Suena muy bien. ¿Cuándo podría tener una entrevista?', hora: '9:27 AM' }
      ],
      6: [
        { tipo: 'postulante', mensaje: '¿El puesto de Empaquetador tiene posibilidades de crecimiento dentro de la empresa?', hora: 'Ayer' }
      ],
      7: [
        { tipo: 'postulante', mensaje: 'Buenas, quisiera saber si para el puesto de Reponedor es necesario tener vehículo propio.', hora: 'Ayer' },
        { tipo: 'reclutador', mensaje: 'Hola Roberto, no es necesario. La empresa proporciona el transporte para la distribución.', hora: 'Ayer' },
        { tipo: 'postulante', mensaje: 'Perfecto, muchas gracias', hora: 'Ayer' }
      ],
      8: [
        { tipo: 'postulante', mensaje: 'Hola, me interesa el puesto de Analista de Calidad. ¿Qué software manejan?', hora: '2 días' },
        { tipo: 'reclutador', mensaje: 'Hola Sofia, manejamos principalmente SAP, Excel avanzado y Power BI para análisis de datos.', hora: '2 días' },
        { tipo: 'postulante', mensaje: 'Perfecto, tengo experiencia en todos esos programas.', hora: '2 días' }
      ]
    };

    // Variables globales
    let conversacionActualId = null;
    let filtroActual = 'todos';

    // Renderizar lista de conversaciones
    function renderizarConversaciones() {
      const lista = document.getElementById('conversacionesLista');
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      
      let conversacionesFiltradas = mensajes.filter(msg => {
        const matchSearch = msg.nombre.toLowerCase().includes(searchTerm) || 
                           msg.mensaje.toLowerCase().includes(searchTerm);
        const matchFilter = filtroActual === 'todos' || 
                           (filtroActual === 'no-leidos' && !msg.leido);
        return matchSearch && matchFilter;
      });

      lista.innerHTML = conversacionesFiltradas.map(msg => `
        <div class="conversacion-item ${!msg.leido ? 'no-leido' : ''} ${conversacionActualId === msg.id ? 'active' : ''}" 
             onclick="abrirConversacion(${msg.id})">
          <div class="flex items-start gap-3">
            <div class="relative flex-shrink-0">
              <div class="avatar avatar-small">${msg.avatar}</div>
              <div class="${msg.online ? 'estado-online' : 'estado-offline'}"></div>
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-start justify-between mb-1">
                <h4 class="font-semibold text-white text-sm truncate">${msg.nombre}</h4>
                <span class="text-xs text-gray-500 flex-shrink-0 ml-2">${msg.hora}</span>
              </div>
              <p class="text-sm text-gray-400 truncate">${msg.mensaje}</p>
              <p class="text-xs text-gray-600 mt-0.5">${msg.puesto}</p>
            </div>
            ${!msg.leido ? '<div class="badge-count">1</div>' : ''}
          </div>
        </div>
      `).join('');

      // Actualizar contadores
      document.getElementById('countTodos').textContent = `(${mensajes.length})`;
      document.getElementById('countNoLeidos').textContent = `(${mensajes.filter(m => !m.leido).length})`;
    }

    // Cambiar filtro
    function cambiarFiltro(filtro) {
      filtroActual = filtro;
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      renderizarConversaciones();
    }

    // Filtrar conversaciones
    function filtrarConversaciones() {
      renderizarConversaciones();
    }

    // Abrir conversación
    function abrirConversacion(id) {
      conversacionActualId = id;
      const mensaje = mensajes.find(m => m.id === id);
      if (!mensaje) return;

      // Ocultar empty state y mostrar chat
      document.getElementById('emptyState').style.display = 'none';
      document.getElementById('chatActivo').style.display = 'flex';

      // Configurar header
      document.getElementById('chatAvatar').textContent = mensaje.avatar;
      document.getElementById('chatNombre').textContent = mensaje.nombre;
      document.getElementById('chatPuesto').textContent = mensaje.puesto;
      document.getElementById('chatEstadoIndicador').className = mensaje.online ? 'estado-online' : 'estado-offline';

      // Marcar como leído
      mensaje.leido = true;
      renderizarConversaciones();

      // Renderizar mensajes
      renderizarMensajes(id);

      // Scroll al final
      setTimeout(() => {
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }, 100);
    }

    // Renderizar mensajes de la conversación
    function renderizarMensajes(id) {
      const chatMessages = document.getElementById('chatMessages');
      const conversacion = conversaciones[id] || [];
      
      chatMessages.innerHTML = conversacion.map(msg => `
        <div class="flex ${msg.tipo === 'reclutador' ? 'justify-end' : 'justify-start'} mb-3">
          <div class="chat-bubble ${msg.tipo}">
            <p class="text-white text-sm leading-relaxed">${msg.mensaje}</p>
            <span class="text-xs text-gray-400 mt-1 block">${msg.hora}</span>
          </div>
        </div>
      `).join('');

      // Simular que está escribiendo ocasionalmente
      if (conversacion.length > 0 && conversacion[conversacion.length - 1].tipo === 'reclutador' && Math.random() > 0.6) {
        chatMessages.innerHTML += `
          <div class="flex justify-start">
            <div class="typing-indicator">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          </div>
        `;
      }
    }

    // Enviar mensaje
    function enviarMensaje() {
      const input = document.getElementById('chatInput');
      const mensaje = input.value.trim();
      
      if (!mensaje || !conversacionActualId) return;

      const chatMessages = document.getElementById('chatMessages');
      const ahora = new Date();
      const hora = ahora.toLocaleTimeString('es-PE', { hour: '2-digit', minute: '2-digit' });

      // Agregar mensaje
      const nuevoMensaje = { tipo: 'reclutador', mensaje: mensaje, hora: hora };
      
      if (!conversaciones[conversacionActualId]) {
        conversaciones[conversacionActualId] = [];
      }
      conversaciones[conversacionActualId].push(nuevoMensaje);

      // Renderizar mensaje
      const mensajeHTML = `
        <div class="flex justify-end mb-3">
          <div class="chat-bubble reclutador">
            <p class="text-white text-sm leading-relaxed">${mensaje}</p>
            <span class="text-xs text-gray-400 mt-1 block">${hora}</span>
          </div>
        </div>
      `;
      
      chatMessages.insertAdjacentHTML('beforeend', mensajeHTML);
      
      // Actualizar preview en lista
      const msgObj = mensajes.find(m => m.id === conversacionActualId);
      if (msgObj) {
        msgObj.mensaje = mensaje;
        msgObj.hora = hora;
        renderizarConversaciones();
      }
      
      // Limpiar input
      input.value = '';
      
      // Scroll al final
      chatMessages.scrollTop = chatMessages.scrollHeight;

      // Simular respuesta automática
      setTimeout(() => {
        const respuestas = [
          'Perfecto, muchas gracias por la información.',
          'Entendido, quedo atento.',
          'Excelente, me parece bien.',
          'Gracias, entonces confirmo mi asistencia.',
          'De acuerdo, estaré pendiente.'
        ];
        
        const respuestaAuto = {
          tipo: 'postulante',
          mensaje: respuestas[Math.floor(Math.random() * respuestas.length)],
          hora: new Date().toLocaleTimeString('es-PE', { hour: '2-digit', minute: '2-digit' })
        };
        
        conversaciones[conversacionActualId].push(respuestaAuto);
        
        const respuestaHTML = `
          <div class="flex justify-start mb-3">
            <div class="chat-bubble postulante">
              <p class="text-white text-sm leading-relaxed">${respuestaAuto.mensaje}</p>
              <span class="text-xs text-gray-400 mt-1 block">${respuestaAuto.hora}</span>
            </div>
          </div>
        `;
        
        chatMessages.insertAdjacentHTML('beforeend', respuestaHTML);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // Actualizar preview
        if (msgObj) {
          msgObj.mensaje = respuestaAuto.mensaje;
          msgObj.hora = respuestaAuto.hora;
          renderizarConversaciones();
        }
      }, 2000);
    }

    // Cerrar chat activo (móvil)
    function cerrarChatActivo() {
      document.getElementById('emptyState').style.display = 'flex';
      document.getElementById('chatActivo').style.display = 'none';
      conversacionActualId = null;
    }

    // Mostrar plantillas
    function mostrarPlantillas() {
      const plantillas = [
        'Hola, gracias por tu interés en el puesto.',
        'Tu perfil ha sido preseleccionado. ¿Cuándo tienes disponibilidad para una entrevista?',
        'Por favor envíanos los siguientes documentos...',
        'La fecha de inicio sería el próximo...',
        'El horario de trabajo es de...'
      ];
      
      const plantilla = plantillas[Math.floor(Math.random() * plantillas.length)];
      document.getElementById('chatInput').value = plantilla;
      document.getElementById('chatInput').focus();
    }

    // Inicializar
    window.addEventListener('load', () => {
      const session = verificarAutenticacion();
      if (session) {
        document.getElementById('userInfo').textContent = `${session.nombre} - ${session.rol}`;
        renderizarConversaciones();
      }
    });
  </script>

</body>
</html>
